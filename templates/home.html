<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      html, body, #map {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
    </style>
    <link rel="stylesheet"
          href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet"
            href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.2.1/lodash.js"></script>

  </head>

  <body>
    <div id="map"></div>

    <script>
      (function() {
        "use strict";

        var center = {{ center|tojson|safe }};
        var data_url = {{ url_for('static', filename="data.json")|tojson|safe }};

        var attribution = '&copy; <a href="http://osm.org/copyright">'
                        + 'OpenStreetMap</a> contributors';
        var map = L.map('map').setView([center.lat, center.lon], 14);
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: attribution
        }).addTo(map);

        $.getJSON(data_url, function(data) {
          _(data).forEach(function(item) {
            var marker = L.marker([item['lat'], item['lon']]);
            marker.addTo(map);
            marker.bindPopup(item['brand'] || "");
          });
        })
      })();
    </script>
  </body>
</html>
